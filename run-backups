#!/bin/sh

echo "Backups: host=${HOST} prefix=${PREFIX}, interval=${INTERVAL}"

while true; do
  ts=$(date -Iseconds)
  archive="/backups/${PREFIX}-${ts}.archive"

  if mongodump --host=${HOST} --archive="${archive}" "$@"; then
    echo "Created backup: ${archive}"
  else
    echo "ERROR ($?) : failed to create backup"
  fi

  sleep ${INTERVAL}
done